<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script type="module" src="https://www.gstatic.com/firebasejs/7.14.5/firebase-app.js"></script>

    <!-- If you enabled Analytics in your project, add the Firebase SDK for Analytics -->
     <script type="module" src="https://www.gstatic.com/firebasejs/7.14.5/firebase-analytics.js"></script>

    <!-- Add Firebase products that you want to use -->
    <script type="module" src="https://www.gstatic.com/firebasejs/7.14.5/firebase-auth.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/7.14.5/firebase-firestore.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/7.14.5/firebase-database.js"></script> 
    <!-- Include other Firebase services if needed
    <script ></script>-->
</head>

<body>
    <form>
        <input type="file" id="my-file-input" name="file" />
        <button id="submit-button">Submit</button>
    </form>

    <script type="text/javascript">
        document.getElementById('submit-button').addEventListener('click', mindeeSubmit);

        async function mindeeSubmit(event) {
            event.preventDefault();

            const myFileInput = document.getElementById('my-file-input');
            const myFile = myFileInput.files[0];

            if (!myFile) {
                return;
            }

            const formData = new FormData();
            formData.append('document', myFile, myFile.name);

            const url = 'https://api.mindee.net/v1/products/skipper-1007/medical_presciption/v1/predict';
            const token = 'b6e0179764e4621de5e7b5d24dd8eb07';

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Token ${token}`
                    },
                    body: formData
                });

                if (response.ok) {
                    const jsonResponse = await response.json();
                    const data = jsonResponse;
                    var hack = {}
                    hack['aadhar'] = data.document.inference.pages[0].prediction.aadhar.values[0].content;
                    hack['age'] = data.document.inference.pages[0].prediction.age.values[0].content;
                    hack['symptoms'] = data.document.inference.pages[0].prediction.symptoms.values[0].content;
                    hack['disease'] = data.document.inference.pages[0].prediction.disease.values[0].content;
                    hack['prescription'] = data.document.inference.pages[0].prediction.prescription.values[0].content;

                    let name1 = '';
                    for (const nameObj of data.document.inference.pages[0].prediction.name.values) {
                        name1 += nameObj.content + ' ';
                    }
                    hack['name'] = name1;

                    let extra_info1 = '';
                    for (const infoObj of data.document.inference.pages[0].prediction.extra_info.values) {
                        extra_info1 += infoObj.content + ' ';
                    }
                    hack['extra_info1'] = extra_info1;

                    console.log(hack);
                } else {
                    console.error('Request failed:', response.statusText);
                }
            } catch (error) {
                console.error('An error occurred:', error);
            }
        }
    </script>
    <script type="module">
        const firebaseConfig = {
            apiKey: "AIzaSyDSqPgNveFY8pXkbz39wng45pP9isLUisM",
            authDomain: "hackout-7a957.firebaseapp.com",
            databaseURL: "hackout-7a957-default-rtdb.asia-southeast1.firebasedatabase.app/",
            projectId: "hackout-7a957",
            storageBucket: "hackout-7a957.appspot.com",
            messagingSenderId: "702923552148",
            appId: "1:702923552148:web:785cb0a1de790692028b81",
            measurementId: "G-PD718GBY5B"
        };
        // extracted json object data 
        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        var userID = aadhar
        var firebaseRef = firebase.database()
        // firebaseRef.ref('users/')
        firebaseRef.ref('users/'+userID).firebaseset.set(hack)
        // document.querySelector('#submit-button').addEventListener('click', () => {
            // firebaseRef.push(hack)
            // firebaseRef.push(hack)
            // firebaseset.set(hack)
        // })
        // firebaseRef.set(hack)
    </script>
    
</body>

</html>